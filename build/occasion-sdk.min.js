!function(root,factory){"function"==typeof define&&define.amd?define(["active-resource","axios","moment","underscore","underscore.string","moment-timezone-with-data-2010-2020"],function(a0,b1,c2,d3,e4,f5){return root.Occasion=factory(a0,b1,c2,d3,e4,f5)}):"object"==typeof module&&module.exports?module.exports=factory(require("active-resource"),require("axios"),require("moment"),require("underscore"),require("underscore.string"),require("moment-timezone-with-data-2010-2020")):root.Occasion=factory(root["active-resource"],root.axios,root.moment,root.underscore,root["underscore.string"],root["moment-timezone-with-data-2010-2020"])}(this,function(ActiveResource,axios,moment,_,s){"use strict";function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();ActiveResource.Interfaces.JsonApi.contentType="application/json";var Occasion=function(){function Occasion(){_classCallCheck(this,Occasion)}return _createClass(Occasion,null,[{key:"Client",value:function(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},url=options.baseUrl||Occasion.baseUrl,token=options.token,immutable=options.immutable||!1;if(!_.isString(token))throw"Token must be of type string";var encodedToken=window.btoa(unescape(encodeURIComponent(token+":"))),libraryOptions={headers:{Authorization:"Basic "+encodedToken},immutable:immutable},resourceLibrary=ActiveResource.createResourceLibrary(url,libraryOptions);return Occasion.Modules.each(function(initializeModule){initializeModule(resourceLibrary)}),resourceLibrary}}]),Occasion}();return Occasion.baseUrl="https://occ.sn/api/v1",Occasion.Modules=ActiveResource.prototype.Collection.build(),Occasion.Modules.push(function(library){library.Answer=function(_library$Base){function Answer(){return _classCallCheck(this,Answer),_possibleConstructorReturn(this,(Answer.__proto__||Object.getPrototypeOf(Answer)).apply(this,arguments))}return _inherits(Answer,_library$Base),Answer}(library.Base),library.Answer.className="Answer",library.Answer.queryName="answers",library.Answer.attributes("value"),library.Answer.belongsTo("question"),library.Answer.belongsTo("option"),library.Answer.belongsTo("order",{inverseOf:"answers"})}),Occasion.Modules.push(function(library){library.Attendee=function(_library$Base2){function Attendee(){return _classCallCheck(this,Attendee),_possibleConstructorReturn(this,(Attendee.__proto__||Object.getPrototypeOf(Attendee)).apply(this,arguments))}return _inherits(Attendee,_library$Base2),Attendee}(library.Base),library.Attendee.className="Attendee",library.Attendee.queryName="attendees",library.Attendee.attributes("address","age","city","country","email","firstName","gender","lastName","phone","state","zip"),library.Attendee.belongsTo("order",{inverseOf:"attendees"})}),Occasion.Modules.push(function(library){library.Coupon=function(_library$Base3){function Coupon(){return _classCallCheck(this,Coupon),_possibleConstructorReturn(this,(Coupon.__proto__||Object.getPrototypeOf(Coupon)).apply(this,arguments))}return _inherits(Coupon,_library$Base3),Coupon}(library.Base),library.Coupon.className="Coupon",library.Coupon.queryName="coupons",library.Coupon.belongsTo("merchant"),library.Coupon.hasMany("orders")}),Occasion.Modules.push(function(library){library.Currency=function(_library$Base4){function Currency(){return _classCallCheck(this,Currency),_possibleConstructorReturn(this,(Currency.__proto__||Object.getPrototypeOf(Currency)).apply(this,arguments))}return _inherits(Currency,_library$Base4),Currency}(library.Base),library.Currency.className="Currency",library.Currency.queryName="currencies",library.Currency.hasMany("merchants"),library.Currency.hasMany("orders")}),Occasion.Modules.push(function(library){library.Customer=function(_library$Base5){function Customer(){return _classCallCheck(this,Customer),_possibleConstructorReturn(this,(Customer.__proto__||Object.getPrototypeOf(Customer)).apply(this,arguments))}return _inherits(Customer,_library$Base5),_createClass(Customer,[{key:"ahoyEmailChanged",value:function(){}}]),Customer}(library.Base),library.Customer.className="Customer",library.Customer.queryName="customers",library.Customer.attributes("email","firstName","lastName","zip"),library.Customer.hasMany("orders",{inverseOf:"customer"}),library.Customer.afterBuild(function(){var lastEmail=null,watchEmail=_.bind(function(){lastEmail!=this.email&&(_.bind(this.ahoyEmailChanged,this)(),lastEmail=this.email),setTimeout(watchEmail,500)},this);setTimeout(watchEmail,500)})}),Occasion.Modules.push(function(library){library.Merchant=function(_library$Base6){function Merchant(){return _classCallCheck(this,Merchant),_possibleConstructorReturn(this,(Merchant.__proto__||Object.getPrototypeOf(Merchant)).apply(this,arguments))}return _inherits(Merchant,_library$Base6),Merchant}(library.Base),library.Merchant.className="Merchant",library.Merchant.queryName="merchants",library.Merchant.belongsTo("currency"),library.Merchant.hasMany("products"),library.Merchant.hasMany("venues")}),Occasion.Modules.push(function(library){library.Option=function(_library$Base7){function Option(){return _classCallCheck(this,Option),_possibleConstructorReturn(this,(Option.__proto__||Object.getPrototypeOf(Option)).apply(this,arguments))}return _inherits(Option,_library$Base7),Option}(library.Base),library.Option.className="Option",library.Option.queryName="options",library.Option.belongsTo("answer"),library.Option.belongsTo("question")}),Occasion.Modules.push(function(library){library.Order=function(_library$Base8){function Order(){return _classCallCheck(this,Order),_possibleConstructorReturn(this,(Order.__proto__||Object.getPrototypeOf(Order)).apply(this,arguments))}return _inherits(Order,_library$Base8),_createClass(Order,[{key:"calculatePrice",value:function(){return this["interface"]().post(this.klass().links().related+"price",this)}},{key:"retrieveInformation",value:function(){return this["interface"]().post(this.klass().links().related+"information",this)}},{key:"charge",value:function(paymentMethod,amount){this.transactions().build({amount:amount,paymentMethod:paymentMethod})}},{key:"editCharge",value:function(paymentMethod,amount){var transaction=this.transactions().target().detect(function(t){return t.paymentMethod()==paymentMethod});transaction&&(transaction.amount=amount)}},{key:"removeCharge",value:function(paymentMethod){var transaction=this.transactions().target().detect(function(t){return t.paymentMethod()==paymentMethod});transaction&&this.transactions().target()["delete"](transaction)}}],[{key:"construct",value:function(attributes){var order=this.build(attributes);order.sessionIdentifier=order.sessionIdentifier||Math.random().toString(36).substring(7)+"-"+Date.now(),null==order.customer()&&order.buildCustomer({email:null,firstName:null,lastName:null,zip:null});var promises=[new Promise(function(resolve){resolve(order)})];null!=order.product()&&promises.push(order.product().questions().includes("options").perPage(500).load());var _this=this;return Promise.all(promises).then(function(args){order=args[0];var questions=args[1];return void 0!=questions&&questions.inject(order,_this.__constructAnswer),order})}},{key:"__constructAnswer",value:function(order,question){if("static"!=question.category){var answer=order.answers().build({question:question});switch(question.formControl){case"drop_down":case"option_list":answer.assignOption(question.options().target().detect(function(o){return o["default"]}));break;case"spin_button":answer.value=question.min}}return order}}]),Order}(library.Base),library.Order.className="Order",library.Order.queryName="orders",library.Order.attributes("sessionIdentifier","status"),library.Order.belongsTo("coupon"),library.Order.belongsTo("currency"),library.Order.belongsTo("customer",{autosave:!0,inverseOf:"orders"}),library.Order.belongsTo("merchant"),library.Order.belongsTo("product"),library.Order.hasMany("answers",{autosave:!0,inverseOf:"order"}),library.Order.hasMany("attendees",{autosave:!0,inverseOf:"order"}),library.Order.hasMany("timeSlots"),library.Order.hasMany("transactions",{autosave:!0,inverseOf:"order"}),library.Order.afterRequest(function(){if(this.product().quantityAware&&!this.product().attendeeQuestions.empty()){var diff=this.quantity-this.attendees().size();if(0!=diff)for(var i=0;i<Math.abs(diff);i++)diff>0?this.attendees().build():this.attendees().target().pop()}})}),Occasion.Modules.push(function(library){library.PaymentMethod=function(_library$Base9){function PaymentMethod(){return _classCallCheck(this,PaymentMethod),_possibleConstructorReturn(this,(PaymentMethod.__proto__||Object.getPrototypeOf(PaymentMethod)).apply(this,arguments))}return _inherits(PaymentMethod,_library$Base9),PaymentMethod}(library.Base),library.PaymentMethod.className="PaymentMethod",library.PaymentMethod.queryName="payment_methods",library.PaymentMethod.hasMany("transactions",{as:"paymentMethod"})}),Occasion.Modules.push(function(library){library.Product=function(_library$Base10){function Product(){return _classCallCheck(this,Product),_possibleConstructorReturn(this,(Product.__proto__||Object.getPrototypeOf(Product)).apply(this,arguments))}return _inherits(Product,_library$Base10),Product}(library.Base),library.Product.className="Product",library.Product.queryName="products",library.Product.belongsTo("merchant"),library.Product.belongsTo("venue"),library.Product.hasMany("orders"),library.Product.hasMany("questions"),library.Product.hasMany("redeemables"),library.Product.hasMany("timeSlots"),library.Product.afterRequest(function(){if(this.attendeeQuestions=ActiveResource.Collection.build(this.attendeeQuestions).map(function(q){return s.camelize(q,!0)}),this.firstTimeSlotStartsAt){if(!this.merchant())throw"Product has timeslots - but merchant.timeZone is not available; include merchant in response.";this.firstTimeSlotStartsAt=moment.tz(this.firstTimeSlotStartsAt,this.merchant().timeZone)}})}),Occasion.Modules.push(function(library){library.Question=function(_library$Base11){function Question(){return _classCallCheck(this,Question),_possibleConstructorReturn(this,(Question.__proto__||Object.getPrototypeOf(Question)).apply(this,arguments))}return _inherits(Question,_library$Base11),Question}(library.Base),library.Question.className="Question",library.Question.queryName="questions",library.Question.belongsTo("product"),library.Question.hasMany("answers"),library.Question.hasMany("options")}),Occasion.Modules.push(function(library){library.Redeemable=function(_library$Base12){function Redeemable(){return _classCallCheck(this,Redeemable),_possibleConstructorReturn(this,(Redeemable.__proto__||Object.getPrototypeOf(Redeemable)).apply(this,arguments))}return _inherits(Redeemable,_library$Base12),Redeemable}(library.Base),library.Redeemable.className="Redeemable",library.Redeemable.queryName="redeemables",library.Redeemable.belongsTo("product")}),Occasion.Modules.push(function(library){library.State=function(_library$Base13){function State(){return _classCallCheck(this,State),_possibleConstructorReturn(this,(State.__proto__||Object.getPrototypeOf(State)).apply(this,arguments))}return _inherits(State,_library$Base13),State}(library.Base),library.State.className="State",library.State.queryName="states"}),Occasion.Modules.push(function(library){library.TimeSlot=function(_library$Base14){function TimeSlot(){return _classCallCheck(this,TimeSlot),_possibleConstructorReturn(this,(TimeSlot.__proto__||Object.getPrototypeOf(TimeSlot)).apply(this,arguments))}return _inherits(TimeSlot,_library$Base14),TimeSlot}(library.Base),library.TimeSlot.className="TimeSlot",library.TimeSlot.queryName="time_slots",library.TimeSlot.belongsTo("product"),library.TimeSlot.belongsTo("venue"),library.TimeSlot.afterRequest(function(){if(!this.product().merchant())throw"Must use includes({ product: 'merchant' }) in timeSlot request";this.startsAt=moment.tz(this.startsAt,this.product().merchant().timeZone)})}),Occasion.Modules.push(function(library){library.Transaction=function(_library$Base15){function Transaction(){return _classCallCheck(this,Transaction),_possibleConstructorReturn(this,(Transaction.__proto__||Object.getPrototypeOf(Transaction)).apply(this,arguments))}return _inherits(Transaction,_library$Base15),Transaction}(library.Base),library.Transaction.className="Transaction",library.Transaction.queryName="transactions",library.Transaction.attributes("amount"),library.Transaction.belongsTo("order",{inverseOf:"answers"}),library.Transaction.belongsTo("paymentMethod",{polymorphic:!0})}),Occasion.Modules.push(function(library){library.Venue=function(_library$Base16){function Venue(){return _classCallCheck(this,Venue),_possibleConstructorReturn(this,(Venue.__proto__||Object.getPrototypeOf(Venue)).apply(this,arguments))}return _inherits(Venue,_library$Base16),Venue}(library.Base),library.Venue.className="Venue",library.Venue.queryName="venues",library.Venue.belongsTo("merchant"),library.Venue.belongsTo("state"),library.Venue.hasMany("products")}),Occasion.Modules.push(function(library){library.CreditCard=function(_library$PaymentMetho){function CreditCard(){return _classCallCheck(this,CreditCard),_possibleConstructorReturn(this,(CreditCard.__proto__||Object.getPrototypeOf(CreditCard)).apply(this,arguments))}return _inherits(CreditCard,_library$PaymentMetho),CreditCard}(library.PaymentMethod),library.CreditCard.className="CreditCard",library.CreditCard.queryName="credit_cards",library.CreditCard.hasMany("transactions",{as:"paymentMethod"})}),Occasion.Modules.push(function(library){library.GiftCard=function(_library$PaymentMetho2){function GiftCard(){return _classCallCheck(this,GiftCard),_possibleConstructorReturn(this,(GiftCard.__proto__||Object.getPrototypeOf(GiftCard)).apply(this,arguments))}return _inherits(GiftCard,_library$PaymentMetho2),GiftCard}(library.PaymentMethod),library.GiftCard.className="GiftCard",library.GiftCard.queryName="gift_cards",library.GiftCard.belongsTo("customer"),library.GiftCard.hasMany("transactions",{as:"paymentMethod"})}),Occasion});